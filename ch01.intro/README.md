# 關於 Go 語言的介紹

計算機在演化，但是編程語言並沒有以同樣的速度演化。現今手機 CPU 核數可能都多於我們使用的第一台電腦。然而我們依舊使用單核設計的技術在編程。

編程的技術同樣在演化。大部分程序不再由單個開發者完成，而是由處於不同時區、不同時間段工作的一組人來完成。大項目分解成小項目，指派給不同程序員，程序員開發完成後，再以可以在各個應用程序中交叉使用的庫或者包的形式，提交給整個團隊。

Go 語言是一種讓代碼分享更容易的編程語言。Go 自帶一些工具，讓使用別人寫的包更容易，並且 Go 語言也讓分享自己寫的包更容易。

Go 語言對傳統的物件導向開發進行了重新思考，並且提供了更高效的復用代碼的手段。Go 語言還讓用戶能更高效利用昂貴伺服器上所有核心，並且它編譯大型項目的速度也很快。

Go 語言附帶的工具可以讓開發人員的生活變得更簡單。

## 用 Go 語言解決現代編程難題

開發人員在為項目選擇語言時，不得不在快速開發和性能之間做出選擇：

- C/C++ 這類語言提供了很快地執行速度
- Ruby 和 Python 擅長快速開發

Go 語言在這兩者間架起了橋樑，不僅提供高性能語言，同時也讓開發更快速

作為一門語言，Go 不僅定義了能做什麼，還定義了不能做什麼。

Go 語言的語法簡潔到只有幾個關鍵字，便於記憶。

Go 語言的編譯器速度飛快，甚至感覺不到在編譯。

Go 語言內置並發機制，所以不用被迫使用特定的線程庫，就能讓軟件擴展，使用更多資源。

Go 語言類型系統簡單高效，不需要為物件導向開發付出額外的心智，讓開發者能專注於代碼復用。

Go 語言自帶垃圾回收器，不需用戶自己管理內存。

讓我們快速瀏覽一下這些關鍵特性：

### 開發速度

一個大型 C/C++ 項目編譯花費的時間比喝杯咖啡的時間還長。

> 程序員合理地逃避工作最常用的藉口：“我的代碼正在編譯呢。”

Go 語言使用了更加智能的編譯器，並簡化了解決依賴的算法，最終提供了更快的編譯速度。編譯 Go 程序時，**編譯器只會關注那些直接被引用的庫**，而不是像 Java、C 和 C++ 那樣，要遍歷依賴鏈中所有依賴的庫。因此，很多 Go 程序可以在一秒內編譯完。在現代硬件上，編譯整個 Go 語言的源碼樹只需要 20 秒。

因為沒有從編譯代碼到執行代碼的中間過程，用動態語言編寫應用可以快速看到輸出。代價是，動態語言不提供靜態語言提供的類型安全特性，不得不用大量測試套件避免運行出現類型錯誤的 bug。

想像一下 JavaScript 的函數接收 ID 欄位。這參數應該是整數，是字符串，還是一個 UUID？要想知道答案，只能去看源代碼。

### 並發

作為程序員，要開發出能充分利用硬件資源的應用程序是一件很難的事情。現代計算機有許多核，但是大部分編程語言都沒有有效的工具讓程序可以輕易利用這些資源。這些語言需要寫大量的線程同步代碼來利用多個核，很容易導致錯誤。

Go 語言對並發的支持是這門語言最重要的特性之一。goroutine 很像線程，但是它佔用的內存遠小於線程，使用它需要的代碼更少。channel 是一種內置的數據結構，可以讓用戶在不同的 goroutine 之間同步發送具有類型的消息。這讓編程模型更傾向於在 goroutine 之間發送消息，而不是讓多個 goroutine 爭奪同一個數據的使用權。讓我們看看這些特性細節：

#### 1. goroutine

goroutine 是可以與其他 goroutine 並行執行的函數，同時也會與主程序 (程序的入口) 並行執行。在其他的編程語言中，你需要用線程來完成同樣的事情，而在 Go 語言中會使用同一個線程來執行多個 goroutine。例如，用戶在寫一個 Web Server，希望同時處理不同的 Web 請求，如果使用 C 和 Java，不得不寫大量的額外代碼來使用線程。在 Go 語言中，net/http 庫直接使用內置的 goroutine。每個接收到的請求都自動在其自己的 goroutine 裡處理。goroutine 使用的內存比線程更少，Go 語言運行時會自動在配置的一組邏輯處理器上調度執行 goroutine。每個邏輯處理器綁定到一個操作系統線程上。這讓用戶的應用程序執行效率更高，而開發工作量顯著減少。

如果想在執行一段代碼的同時，並行去做另外一件事情，goroutine 是很好的選擇。下面是一個簡單例子：

```go
package main

func log(msg string) {
  // ... 這裡是一些記錄日誌的代碼
}

// 代碼裡有些地方檢測到了錯誤
go log("發生了可怕的事情")
```

關鍵字 go 是唯一需要去編寫的代碼，調度 log 函數作為獨立的 goroutine 去運行，以便與其他 goroutine 並行執行。這意味著應用程序的其餘部分會與記錄日誌並行執行，通常這種並行能讓最終用戶覺得性能更好。就像之前說的，goroutine 佔用的資源更少，所以常常能啟動成千上萬個 goroutine。我們會在 chap 06 更加深入探討 goroutine 和併發。

#### 2. 通道

通道是一種數據結構，可以讓 goroutine 之間進行安全的數據通信。通道可以幫用戶避免其他語言裡常見的共享內存訪問的問題。

併發最難部分就是要確保其他併發運行的的進程、線程或 goroutine 不會意外修改用戶的數據。當不同的線程在沒有同步保護的情況下修改同一個數據時，總會發生災難。在其他語言中，如果使用全局變數或共享內存，必須使用複雜的鎖規則來防止對同一個變數的不同步修改。

為解決這個問題，通道提供了一種新模式，從而保證併發修改時的數據安全。通道這一模式保證同一時刻只會有一個 goroutine 修改數據。通道用於在幾個運行的 goroutine 之間